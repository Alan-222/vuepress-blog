(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{456:function(t,e,a){"use strict";a.r(e);var s=a(2),r=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[t._v("组件间通信方式除了父->子：props、子->父：$emits 和 ref / $refs 及 Vuex 等等方式之外，还有一种方式全局事件总线，也叫 GlobalEventBus 能够实现任意组件间的通信。本文就来讲解一下如何去实现它。")]),t._v(" "),e("h2",{attrs:{id:"原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),e("h3",{attrs:{id:"一个重要的内置关系-vuecomponent-prototype-proto-vue-prototype"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一个重要的内置关系-vuecomponent-prototype-proto-vue-prototype"}},[t._v("#")]),t._v(" 一个重要的内置关系：VueComponent.prototype.proto === Vue.prototype")]),t._v(" "),e("p",[t._v("首先我们先明确一个内置关系 VueComponent.prototype. "),e("strong",[t._v("proto")]),t._v("=Vue.prototype，下面用图来说明此关系，那么为什么要有这个关系呢？其实就是因为让组件实例对象（VC）可以访问到 Vue 原型上的属性、方法")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3724dd01a2d74ede8806eb7c225ab1d6~tplv-k3u1fbpfcp-watermark.image?",alt:"内置关系说明.png"}})]),t._v(" "),e("h2",{attrs:{id:"实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),e("p",[t._v("既然有了这个关系，那么我们便可以在 Vue 的原型中添加一个$bus 变量来存储共有的需要的值")]),t._v(" "),e("h3",{attrs:{id:"安装全局事件总线"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装全局事件总线"}},[t._v("#")]),t._v(" 安装全局事件总线")]),t._v(" "),e("p",[t._v("main.js：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("import Vue from 'vue';\nimport App from './App.vue';\n\nVue.config.productionTip = false;\n\nconst vm = new Vue({\n  render: (h) => h(App),\n  beforeCreate() {\n    Vue.prototype.$bus = this;\n  }\n}).$mount('#app');\n")])])]),e("h3",{attrs:{id:"使用事件总线"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用事件总线"}},[t._v("#")]),t._v(" 使用事件总线")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("接收数据：A 组件想接收数据，则在 A 组件中给$bus 绑定自定义事件，事件的回调留在 A 组件自身。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("methods(){\n  xxx(data){......}\n}\n......\nmounted() {\n  this.$bus.$on('xxxx',this.xxx)\n}\n")])])])]),t._v(" "),e("li",[e("p",[t._v("提供数据："),e("code",[t._v("this.$bus.$emit('xxxx',数据)")])])])]),t._v(" "),e("h3",{attrs:{id:"解绑所用到的事件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解绑所用到的事件"}},[t._v("#")]),t._v(" 解绑所用到的事件")]),t._v(" "),e("p",[t._v("在 beforeDestroy 钩子中，用$off 去解绑当前组件所用到的事件")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("beforeDestory(){\n   this.$bus.off('xxxx')\n}\n")])])]),e("h2",{attrs:{id:"案例说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#案例说明"}},[t._v("#")]),t._v(" 案例说明")]),t._v(" "),e("p",[t._v("我们通过全局事件总线来实现兄弟间的通信")]),t._v(" "),e("p",[t._v("brother1.vue:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(' data () {\n       return {\n           List:[\n               {id:1,name:"张三",age:18},\n               {id:2,name:"李四",age:23},\n               {id:3,name:"王五",age:30},\n               {id:4,name:"陆六",age:46},\n               {id:5,name:"燕七",age:7}\n           ]\n       }\n   },\n   methods: {\n       sendPeopleInfo(){\n           this.$bus.$emit(\'peopleInfo\',this.List)\n       }\n   }\n')])])]),e("p",[t._v("brother2.vue:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("   data() {\n       return {\n           pList:[]\n       }\n   },\n   mounted() {\n        this.$bus.$on('peopleInfo',(data) => {\n            this.pList=data\n        })\n   },\n")])])]),e("p",[t._v("页面效果：")]),t._v(" "),e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1270e4ad34c94b9ba95c67128e5ecdbe~tplv-k3u1fbpfcp-watermark.image?",alt:"img.png",referrerpolicy:"no-referrer"}}),t._v(" "),e("h3",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("这就是有关 Vue 全局事件总线的全部内容，适用于任意组件中通信，而且比 Vuex 通信方式更为简单。我们下期再见！")])])}),[],!1,null,null,null);e.default=r.exports}}]);